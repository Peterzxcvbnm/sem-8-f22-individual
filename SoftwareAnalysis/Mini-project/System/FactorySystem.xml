<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>//----------disc-----------------------------
const int disc_numberOfSlots = 4;
typedef int[0,disc_numberOfSlots-1] id_t;
chan disc_goto[disc_numberOfSlots];
chan disc_addItemCmd, disc_removeItemCmd;
chan disc_addItem[disc_numberOfSlots];
broadcast chan disc_removeItem[disc_numberOfSlots];

//default tags
chan disc_getFreeSlot;
chan disc_foundEmptySlot;
chan disc_setColour[disc_numberOfSlots][4];
bool disc_occupiedSlots[disc_numberOfSlots];
chan disc_getColourSlot[disc_numberOfSlots];
chan disc_gottenColourSlot;

//Finsihed tag
chan disc_set_finished[disc_numberOfSlots];
chan disc_getSlot_finished;
chan disc_foundSlot_finished;
bool disc_slots_finished[disc_numberOfSlots];

//Zones: 
int zones_intake = 1;
int zones_crane = 2;
int zones_camera = 3;

//--------------------Camera------------------------
chan camera_getColour;
chan camera_gottenColour;

//--------------------Crane------------------------
chan crane_toggleMagnet;
chan crane_lowerMagnet, crane_raiseMagnet;
chan crane_goto_intake, crane_goto_red, crane_goto_blue, crane_goto_green;


//-----------------current slots-----------------------------
int currentSlot_empty = -1;
int currentSlot_finished = -1;

/**
1: Red
2: Green
3: Blue
*/
int colour = 0;
int currentSlot_colour = 0;

//--------------------defaults------------------------
clock GlobalTimer;
broadcast chan emergencyStop;

/**
1: Tried to remove item from empty disc slot
2: Tried to add item to full slot
4:
8:
*/
int error;</declaration>
	<template>
		<name>MasterController</name>
		<declaration>







clock timer;</declaration>
		<location id="id0" x="722" y="272">
			<name x="712" y="242">Idle</name>
		</location>
		<location id="id1" x="850" y="212">
			<name x="840" y="182">getEmptySlot</name>
			<committed/>
		</location>
		<location id="id2" x="864" y="73">
			<name x="854" y="43">slotEmpty</name>
		</location>
		<location id="id3" x="1059" y="81">
			<name x="1049" y="51">gotoIntake</name>
		</location>
		<location id="id4" x="1229" y="183">
			<name x="1219" y="153">fillSlot</name>
		</location>
		<location id="id5" x="1263" y="353">
			<name x="1253" y="323">gotoCamera</name>
		</location>
		<location id="id6" x="1000" y="512">
			<name x="990" y="482">scanItem</name>
			<committed/>
		</location>
		<location id="id7" x="850" y="512">
			<name x="840" y="482">itemColour</name>
		</location>
		<location id="id8" x="595" y="518">
			<name x="570" y="476">setItemColour</name>
		</location>
		<location id="id9" x="416" y="263">
			<name x="406" y="229">markSlotFinishedIn10Seconds</name>
		</location>
		<location id="id10" x="357" y="535">
			<name x="272" y="552">markSlotFinishedIn20Seconds</name>
		</location>
		<location id="id11" x="467" y="680">
			<name x="457" y="646">markSlotFinishedIn30Seconds</name>
		</location>
		<location id="id12" x="289" y="161">
			<name x="279" y="127">SetFinsihedRed</name>
		</location>
		<location id="id13" x="153" y="544">
			<name x="143" y="510">setFinishedGreen</name>
		</location>
		<location id="id14" x="263" y="722">
			<name x="253" y="688">setFinishedBlue</name>
		</location>
		<location id="id15" x="527" y="68">
			<name x="517" y="34">getFinishedSlot</name>
			<committed/>
		</location>
		<location id="id16" x="357" y="-17">
			<name x="347" y="-51">slotFinished</name>
		</location>
		<location id="id17" x="382" y="-102">
			<name x="372" y="-136">gotoCrane</name>
		</location>
		<location id="id18" x="561" y="-144">
			<name x="551" y="-178">gotoIntake_crane</name>
		</location>
		<location id="id19" x="765" y="-136">
			<name x="755" y="-170">craneLower</name>
		</location>
		<location id="id20" x="926" y="-127">
			<name x="916" y="-161">toggleMagnet_crane</name>
		</location>
		<location id="id21" x="1096" y="-119">
			<name x="1086" y="-153">getColourOfSlot</name>
			<committed/>
		</location>
		<location id="id22" x="1300" y="-136">
			<name x="1300" y="-136">thingIsRed</name>
		</location>
		<location id="id23" x="1292" y="-93">
			<name x="1292" y="-93">thingIsGreen</name>
		</location>
		<location id="id24" x="1275" y="-34">
			<name x="1275" y="-34">thingIsBlue</name>
		</location>
		<location id="id25" x="1453" y="-127">
			<name x="1443" y="-161">gotoRed_crane</name>
		</location>
		<location id="id26" x="1436" y="-76">
			<name x="1426" y="-110">gotoGreen_crane</name>
		</location>
		<location id="id27" x="1411" y="0">
			<name x="1401" y="-34">gotoBlue_crane</name>
		</location>
		<location id="id28" x="1360" y="110">
			<name x="1350" y="76">craneLowerBlue</name>
		</location>
		<location id="id29" x="1419" y="110">
			<name x="1409" y="76">craneLowerGreen</name>
		</location>
		<location id="id30" x="1462" y="110">
			<name x="1452" y="76">craneLowerRed</name>
		</location>
		<location id="id31" x="1360" y="187">
			<name x="1350" y="153">toggleMagnetBlue</name>
		</location>
		<location id="id32" x="1419" y="178">
			<name x="1409" y="144">toggleMagnetGreen</name>
		</location>
		<location id="id33" x="1470" y="187">
			<name x="1460" y="153">toggleMagnetRed</name>
		</location>
		<location id="id34" x="1419" y="289">
			<name x="1409" y="255">EndIf</name>
		</location>
		<location id="id35" x="1419" y="374">
			<name x="1409" y="340">markEmpty</name>
		</location>
		<location id="id36" x="1011" y="-93">
			<name x="1001" y="-127">craneRaise</name>
		</location>
		<location id="id37" x="1513" y="297">
			<name x="1503" y="263">craneRaise1</name>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id37"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="1437" y="318">disc_removeItem[currentSlot_finished]!</label>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id37"/>
			<label kind="synchronisation" x="1437" y="276">crane_raiseMagnet!</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="718" y="148">GlobalTimer &gt; 2</label>
			<nail x="790" y="153"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id0"/>
			<label kind="guard" x="545" y="51">GlobalTimer &gt; 2</label>
			<nail x="697" y="102"/>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id0"/>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id34"/>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id34"/>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id34"/>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id33"/>
			<label kind="synchronisation" x="1466" y="131">crane_toggleMagnet!</label>
		</transition>
		<transition>
			<source ref="id29"/>
			<target ref="id32"/>
			<label kind="synchronisation" x="1419" y="127">crane_toggleMagnet!</label>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id31"/>
			<label kind="synchronisation" x="1360" y="131">crane_toggleMagnet!</label>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id30"/>
			<label kind="synchronisation" x="1457" y="-25">crane_lowerMagnet!</label>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id29"/>
			<label kind="synchronisation" x="1427" y="0">crane_lowerMagnet!</label>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="1385" y="38">crane_lowerMagnet!</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="1293" y="-34">crane_goto_blue!</label>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="1310" y="-101">crane_goto_green!</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id25"/>
			<label kind="synchronisation" x="1318" y="-148">crane_goto_red!</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id24"/>
			<label kind="guard" x="1114" y="-110">currentSlot_colour == 3</label>
			<label kind="synchronisation" x="1114" y="-93">disc_gottenColourSlot?</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id23"/>
			<label kind="guard" x="1114" y="-140">currentSlot_colour == 2</label>
			<label kind="synchronisation" x="1114" y="-123">disc_gottenColourSlot?</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id22"/>
			<label kind="guard" x="1114" y="-161">currentSlot_colour == 1</label>
			<label kind="synchronisation" x="1114" y="-144">disc_gottenColourSlot?</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id36"/>
			<label kind="synchronisation" x="968" y="-110">crane_raiseMagnet!</label>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id21"/>
			<label kind="synchronisation" x="1053" y="-106">disc_getColourSlot[currentSlot_finished]!</label>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id20"/>
			<label kind="synchronisation" x="783" y="-148">crane_toggleMagnet!</label>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="579" y="-157">crane_lowerMagnet!</label>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id18"/>
			<label kind="synchronisation" x="400" y="-140">crane_goto_intake!</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="369" y="-76">disc_goto[(zones_crane + currentSlot_finished) % disc_numberOfSlots]!</label>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="375" y="8">disc_foundSlot_finished?</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="545" y="123">disc_getSlot_finished!</label>
			<label kind="assignment" x="545" y="140">GlobalTimer = 0,
timer = 0</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id0"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id0"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id0"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id14"/>
			<label kind="guard" x="281" y="667">timer &gt;= 30</label>
			<label kind="synchronisation" x="281" y="684">disc_set_finished[currentSlot_empty]!</label>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id13"/>
			<label kind="guard" x="171" y="505">timer &gt;= 20</label>
			<label kind="synchronisation" x="171" y="522">disc_set_finished[currentSlot_empty]!</label>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id12"/>
			<label kind="guard" x="307" y="178">timer &gt;= 10</label>
			<label kind="synchronisation" x="307" y="195">disc_set_finished[currentSlot_empty]!</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id11"/>
			<label kind="guard" x="501" y="586">colour == 3</label>
			<label kind="assignment" x="518" y="603">timer = 0</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id10"/>
			<label kind="guard" x="399" y="476">colour == 2</label>
			<label kind="assignment" x="468" y="488">timer = 0</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="guard" x="493" y="357">colour == 1</label>
			<label kind="assignment" x="493" y="340">timer = 0</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="678" y="496">disc_setColour[currentSlot_empty][colour]!</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="991" y="191">disc_foundEmptySlot?</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="918" y="25">disc_goto[(zones_intake + currentSlot_empty) % disc_numberOfSlots]!</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="1204" y="242">disc_addItem[currentSlot_empty]!</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="940" y="422">camera_getColour!</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="881" y="514">camera_gottenColour?</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="715" y="197">disc_getFreeSlot!</label>
			<label kind="assignment" x="718" y="212">GlobalTimer = 0,
timer = 0</label>
		</transition>
	</template>
	<template>
		<name>Camera</name>
		<location id="id38" x="-17" y="76">
			<name x="-27" y="46">Idle</name>
		</location>
		<location id="id39" x="-221" y="76">
			<name x="-231" y="46">Red</name>
			<committed/>
		</location>
		<location id="id40" x="178" y="76">
			<name x="168" y="46">Green</name>
			<committed/>
		</location>
		<location id="id41" x="-17" y="229">
			<name x="-27" y="199">Blue</name>
			<committed/>
		</location>
		<init ref="id38"/>
		<transition>
			<source ref="id41"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="-93" y="153">camera_gottenColour!</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id41"/>
			<label kind="synchronisation" x="-85" y="136">camera_getColour?</label>
			<label kind="assignment" x="-59" y="119">colour = 3</label>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="0" y="76">camera_gottenColour!</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id40"/>
			<label kind="synchronisation" x="8" y="59">camera_getColour?</label>
			<label kind="assignment" x="34" y="42">colour=2</label>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="-195" y="76">camera_gottenColour!</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id39"/>
			<label kind="synchronisation" x="-195" y="59">camera_getColour?</label>
			<label kind="assignment" x="-161" y="42">colour = 1</label>
		</transition>
	</template>
	<template>
		<name>GetEmptySlot</name>
		<location id="id42" x="40" y="80">
			<name x="30" y="50">Idle</name>
		</location>
		<location id="id43" x="144" y="-34">
			<name x="134" y="-64">Get4</name>
			<committed/>
		</location>
		<location id="id44" x="102" y="255">
			<name x="92" y="225">Get1</name>
			<committed/>
		</location>
		<location id="id45" x="-161" y="221">
			<name x="-171" y="191">Get2</name>
			<committed/>
		</location>
		<location id="id46" x="-170" y="34">
			<name x="-180" y="4">Get3</name>
			<committed/>
		</location>
		<init ref="id42"/>
		<transition>
			<source ref="id43"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="59" y="34">disc_foundEmptySlot!</label>
			<label kind="assignment" x="34" y="0">currentSlot_empty = 3</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id43"/>
			<label kind="guard" x="25" y="-17">!disc_occupiedSlots[3]</label>
			<label kind="synchronisation" x="76" y="59">disc_getFreeSlot?</label>
		</transition>
		<transition>
			<source ref="id46"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="-127" y="42">disc_foundEmptySlot!</label>
			<label kind="assignment" x="-127" y="17">currentSlot_empty = 2</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id46"/>
			<label kind="guard" x="-127" y="0">!disc_occupiedSlots[2]</label>
			<label kind="synchronisation" x="-144" y="-17">disc_getFreeSlot?</label>
		</transition>
		<transition>
			<source ref="id45"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="-238" y="119">disc_foundEmptySlot!</label>
			<label kind="assignment" x="-238" y="136">currentSlot_empty = 1</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id45"/>
			<label kind="guard" x="-238" y="153">!disc_occupiedSlots[1]</label>
			<label kind="synchronisation" x="-238" y="102">disc_getFreeSlot?</label>
		</transition>
		<transition>
			<source ref="id44"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="0" y="153">disc_foundEmptySlot!</label>
			<label kind="assignment" x="0" y="178">currentSlot_empty = 0</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id44"/>
			<label kind="guard" x="-8" y="127">!disc_occupiedSlots[0]</label>
			<label kind="synchronisation" x="34" y="195">disc_getFreeSlot?</label>
		</transition>
	</template>
	<template>
		<name>GetFinishedSlot</name>
		<location id="id47" x="40" y="80">
			<name x="0" y="0">Idle</name>
		</location>
		<location id="id48" x="190" y="80">
			<name x="0" y="0">Get4</name>
			<committed/>
		</location>
		<location id="id49" x="190" y="230">
			<name x="0" y="0">Get1</name>
			<committed/>
		</location>
		<location id="id50" x="40" y="230">
			<name x="0" y="0">Get2</name>
			<committed/>
		</location>
		<location id="id51" x="340" y="80">
			<name x="0" y="0">Get3</name>
			<committed/>
		</location>
		<init ref="id47"/>
		<transition>
			<source ref="id48"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="0" y="0">disc_foundSlot_finished!</label>
			<label kind="assignment" x="0" y="0">currentSlot_finished = 3</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id48"/>
			<label kind="guard" x="0" y="0">disc_slots_finished[3]</label>
			<label kind="synchronisation" x="0" y="0">disc_getSlot_finished?</label>
		</transition>
		<transition>
			<source ref="id51"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="0" y="0">disc_foundSlot_finished!</label>
			<label kind="assignment" x="0" y="0">currentSlot_finished = 2</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id51"/>
			<label kind="guard" x="0" y="0">disc_slots_finished[2]</label>
			<label kind="synchronisation" x="0" y="0">disc_getSlot_finished?</label>
		</transition>
		<transition>
			<source ref="id50"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="0" y="0">disc_foundSlot_finished!</label>
			<label kind="assignment" x="0" y="0">currentSlot_finished = 1</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id50"/>
			<label kind="guard" x="0" y="0">disc_slots_finished[1]</label>
			<label kind="synchronisation" x="0" y="0">disc_getSlot_finished?</label>
		</transition>
		<transition>
			<source ref="id49"/>
			<target ref="id47"/>
			<label kind="synchronisation" x="0" y="0">disc_foundSlot_finished!</label>
			<label kind="assignment" x="0" y="0">currentSlot_finished = 0</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id49"/>
			<label kind="guard" x="0" y="0">disc_slots_finished[0]</label>
			<label kind="synchronisation" x="0" y="0">disc_getSlot_finished?</label>
		</transition>
	</template>
	<template>
		<name>Disc</name>
		<location id="id52" x="40" y="80">
			<name x="30" y="50">Position1</name>
		</location>
		<location id="id53" x="190" y="80">
			<name x="180" y="50">Position2</name>
		</location>
		<location id="id54" x="190" y="230">
			<name x="180" y="200">Position3</name>
		</location>
		<location id="id55" x="40" y="230">
			<name x="30" y="200">Position4</name>
		</location>
		<location id="id56" x="340" y="80">
			<name x="330" y="50">AddItem1Req</name>
		</location>
		<location id="id57" x="340" y="230">
			<name x="330" y="200">RemoveItem1Req</name>
		</location>
		<location id="id58" x="340" y="380">
			<name x="330" y="350">AddItem2Req</name>
		</location>
		<location id="id59" x="190" y="380">
			<name x="180" y="350">RemoveItem2Req</name>
		</location>
		<location id="id60" x="40" y="380">
			<name x="30" y="350">AddItem3Req</name>
		</location>
		<location id="id61" x="490" y="80">
			<name x="480" y="50">RemoveItem3Req</name>
		</location>
		<location id="id62" x="490" y="230">
			<name x="480" y="200">AddItem4Req</name>
		</location>
		<location id="id63" x="490" y="380">
			<name x="480" y="350">RemoveItem4Req</name>
		</location>
		<location id="id64" x="-238" y="68">
			<name x="-238" y="68">Stopped</name>
		</location>
		<init ref="id52"/>
		<transition>
			<source ref="id54"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="-24" y="149">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="-24" y="74">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="-99" y="74">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="-99" y="149">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="55" y="140">disc_goto[1]?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="55" y="140">disc_goto[3]?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="55" y="140">disc_goto[2]?</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="55" y="140">disc_goto[0]?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="55" y="215">disc_goto[2]?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="-20" y="140">disc_goto[3]?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="55" y="65">disc_goto[0]?</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="130" y="140">disc_goto[1]?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="55" y="65">disc_goto[1]?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="-20" y="140">disc_goto[0]?</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="55" y="215">disc_goto[3]?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="130" y="140">disc_goto[2]?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="40" y="80">disc_goto[0]?</label>
			<nail x="10" y="50"/>
			<nail x="70" y="50"/>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="190" y="80">disc_goto[1]?</label>
			<nail x="160" y="50"/>
			<nail x="220" y="50"/>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="190" y="230">disc_goto[2]?</label>
			<nail x="160" y="200"/>
			<nail x="220" y="200"/>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="40" y="230">disc_goto[3]?</label>
			<nail x="10" y="200"/>
			<nail x="70" y="200"/>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id56"/>
			<label kind="synchronisation" x="130" y="65">disc_addItemCmd?</label>
		</transition>
		<transition>
			<source ref="id52"/>
			<target ref="id57"/>
			<label kind="synchronisation" x="130" y="140">disc_removeItemCmd?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id58"/>
			<label kind="synchronisation" x="205" y="215">disc_addItemCmd?</label>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id59"/>
			<label kind="synchronisation" x="130" y="215">disc_removeItemCmd?</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id60"/>
			<label kind="synchronisation" x="55" y="290">disc_addItemCmd?</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id61"/>
			<label kind="synchronisation" x="280" y="140">disc_removeItemCmd?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id62"/>
			<label kind="synchronisation" x="205" y="215">disc_addItemCmd?</label>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id63"/>
			<label kind="synchronisation" x="205" y="290">disc_removeItemCmd?</label>
		</transition>
		<transition>
			<source ref="id56"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="130" y="65">disc_addItem[0]!</label>
		</transition>
		<transition>
			<source ref="id57"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="130" y="140">disc_removeItem[0]!</label>
		</transition>
		<transition>
			<source ref="id58"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="205" y="215">disc_addItem[1]!</label>
		</transition>
		<transition>
			<source ref="id59"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="130" y="215">disc_removeItem[1]!</label>
		</transition>
		<transition>
			<source ref="id60"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="55" y="290">disc_addItem[2]!</label>
		</transition>
		<transition>
			<source ref="id61"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="280" y="140">disc_removeItem[2]!</label>
		</transition>
		<transition>
			<source ref="id62"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="205" y="215">disc_addItem[3]!</label>
		</transition>
		<transition>
			<source ref="id63"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="205" y="290">disc_removeItem[3]!</label>
		</transition>
	</template>
	<template>
		<name>DiscSlot</name>
		<parameter>const id_t id</parameter>
		<location id="id65" x="42" y="170">
			<name x="2" y="90">SlotEmpty</name>
		</location>
		<location id="id66" x="190" y="80">
			<name x="0" y="0">SlotFull</name>
		</location>
		<location id="id67" x="-238" y="17">
			<name x="-428" y="-213">SlotFullRed</name>
		</location>
		<location id="id68" x="40" y="230">
			<name x="0" y="0">GetColourRed</name>
			<committed/>
		</location>
		<location id="id69" x="340" y="80">
			<name x="0" y="0">SlotFullGreen</name>
		</location>
		<location id="id70" x="340" y="230">
			<name x="0" y="0">GetColourGreen</name>
			<committed/>
		</location>
		<location id="id71" x="340" y="380">
			<name x="0" y="0">SlotFullBlue</name>
		</location>
		<location id="id72" x="190" y="380">
			<name x="0" y="0">GetColourBlue</name>
			<committed/>
		</location>
		<location id="id73" x="40" y="380">
			<name x="0" y="0">ErrorAddItemToFull</name>
		</location>
		<location id="id74" x="490" y="80">
			<name x="0" y="0">ErrorRemoveItemFromEmpty</name>
		</location>
		<init ref="id65"/>
		<transition>
			<source ref="id65"/>
			<target ref="id66"/>
			<label kind="synchronisation" x="0" y="0">disc_addItem[id]?</label>
			<label kind="assignment" x="0" y="0">disc_occupiedSlots[id] = true</label>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id67"/>
			<label kind="synchronisation" x="0" y="0">disc_setColour[id][1]?</label>
		</transition>
		<transition>
			<source ref="id67"/>
			<target ref="id68"/>
			<label kind="synchronisation" x="0" y="0">disc_getColourSlot[id]?</label>
			<label kind="assignment" x="0" y="0">currentSlot_colour = 1</label>
		</transition>
		<transition>
			<source ref="id68"/>
			<target ref="id67"/>
			<label kind="synchronisation" x="115" y="230">disc_gottenColourSlot!</label>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id69"/>
			<label kind="synchronisation" x="0" y="0">disc_setColour[id][2]?</label>
		</transition>
		<transition>
			<source ref="id69"/>
			<target ref="id70"/>
			<label kind="synchronisation" x="0" y="0">disc_getColourSlot[id]?</label>
			<label kind="assignment" x="0" y="0">currentSlot_colour = 2</label>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id69"/>
			<label kind="synchronisation" x="340" y="155">disc_gottenColourSlot!</label>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="0" y="0">disc_setColour[id][3]?</label>
		</transition>
		<transition>
			<source ref="id71"/>
			<target ref="id72"/>
			<label kind="synchronisation" x="0" y="0">disc_getColourSlot[id]?</label>
			<label kind="assignment" x="0" y="0">currentSlot_colour = 3</label>
		</transition>
		<transition>
			<source ref="id72"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="265" y="380">disc_gottenColourSlot!</label>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="0" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="0" y="0">disc_occupiedSlots[id] = false, disc_slots_finished[id] = false</label>
		</transition>
		<transition>
			<source ref="id67"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="0" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="0" y="0">disc_occupiedSlots[id] = false, disc_slots_finished[id] = false</label>
		</transition>
		<transition>
			<source ref="id69"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="0" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="0" y="0">disc_occupiedSlots[id] = false, disc_slots_finished[id] = false</label>
		</transition>
		<transition>
			<source ref="id71"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="0" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="0" y="0">disc_occupiedSlots[id] = false, disc_slots_finished[id] = false</label>
		</transition>
		<transition>
			<source ref="id65"/>
			<target ref="id74"/>
			<label kind="synchronisation" x="0" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="0" y="0">error += 1</label>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="0" y="0">disc_addItem[id]?</label>
			<label kind="assignment" x="0" y="0">error += 2</label>
		</transition>
		<transition>
			<source ref="id67"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="0" y="0">disc_addItem[id]?</label>
			<label kind="assignment" x="0" y="0">error += 2</label>
		</transition>
		<transition>
			<source ref="id69"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="0" y="0">disc_addItem[id]?</label>
			<label kind="assignment" x="0" y="0">error += 2</label>
		</transition>
		<transition>
			<source ref="id71"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="0" y="0">disc_addItem[id]?</label>
			<label kind="assignment" x="0" y="0">error += 2</label>
		</transition>
	</template>
	<template>
		<name>SlotVariable_finished</name>
		<parameter>const id_t id</parameter>
		<location id="id75" x="0" y="0">
			<name x="-10" y="-34">IsFinished</name>
		</location>
		<location id="id76" x="178" y="0">
			<name x="168" y="-34">IsNotFinished</name>
		</location>
		<init ref="id76"/>
		<transition>
			<source ref="id76"/>
			<target ref="id75"/>
			<label kind="synchronisation" x="103" y="-34">disc_set_finished[id]?</label>
			<label kind="assignment" x="89" y="0">disc_slots_finished[id] = true</label>
			<nail x="85" y="-34"/>
		</transition>
		<transition>
			<source ref="id75"/>
			<target ref="id76"/>
			<label kind="synchronisation" x="18" y="4">disc_set_finished[id]?</label>
			<label kind="assignment" x="89" y="0">disc_slots_finished[id] = false</label>
			<nail x="102" y="42"/>
		</transition>
		<transition>
			<source ref="id75"/>
			<target ref="id76"/>
			<label kind="synchronisation" x="89" y="0">disc_removeItem[id]?</label>
			<label kind="assignment" x="89" y="0">disc_slots_finished[id] = false</label>
		</transition>
	</template>
	<template>
		<name>Crane</name>
		<declaration>

// Place local declarations here.
bool magnetPower =  false;</declaration>
		<location id="id77" x="-365" y="-25">
			<name x="-424" y="-34">Intake</name>
		</location>
		<location id="id78" x="-365" y="433">
			<name x="-375" y="403">Red</name>
		</location>
		<location id="id79" x="42" y="-25">
			<name x="-17" y="-34">Green</name>
		</location>
		<location id="id80" x="42" y="433">
			<name x="-1" y="416">Blue</name>
		</location>
		<location id="id81" x="-170" y="510">
			<name x="-212" y="476">LoweredAtRed</name>
		</location>
		<location id="id82" x="-170" y="-102">
			<name x="-153" y="-111">LoweredAtGreen</name>
		</location>
		<location id="id83" x="272" y="85">
			<name x="229" y="51">LoweredAtBlue</name>
		</location>
		<location id="id84" x="-595" y="85">
			<name x="-654" y="102">LoweredAtIntake</name>
		</location>
		<location id="id85" x="-170" y="85">
			<name x="-180" y="51">Stopped</name>
		</location>
		<init ref="id77"/>
		<transition>
			<source ref="id83"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-127" y="76">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id84"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-510" y="68">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-289" y="42">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-127" y="212">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id82"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-229" y="17">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-161" y="34">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-306" y="221">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id81"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-221" y="127">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id84"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-578" y="0">crane_raiseMagnet?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id84"/>
			<label kind="synchronisation" x="-578" y="-17">crane_lowerMagnet?</label>
		</transition>
		<transition>
			<source ref="id83"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="161" y="263">crane_raiseMagnet?</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id83"/>
			<label kind="synchronisation" x="161" y="246">crane_lowerMagnet?</label>
		</transition>
		<transition>
			<source ref="id82"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="-153" y="-76">crane_raiseMagnet?</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="-153" y="-59">crane_lowerMagnet?</label>
		</transition>
		<transition>
			<source ref="id81"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-357" y="510">crane_raiseMagnet?</label>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id81"/>
			<label kind="synchronisation" x="-357" y="493">crane_lowerMagnet?</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-323" y="-25">crane_goto_intake?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="-153" y="-25">crane_goto_green?</label>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-501" y="195">crane_goto_intake?</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-297" y="306">crane_goto_red?</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="-17" y="0">crane_goto_green?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="-110" y="331">crane_goto_blue?</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-365" y="17">crane_goto_intake?</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="-17" y="314">crane_goto_blue?</label>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="-85" y="17">crane_goto_green?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-484" y="212">crane_goto_red?</label>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="-136" y="416">crane_goto_blue?</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-306" y="416">crane_goto_red?</label>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id77"/>
			<label kind="synchronisation" x="-425" y="-76">crane_goto_intake?</label>
			<nail x="-395" y="-55"/>
			<nail x="-335" y="-55"/>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id78"/>
			<label kind="synchronisation" x="-416" y="458">crane_goto_red?</label>
			<nail x="-391" y="458"/>
			<nail x="-340" y="458"/>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="25" y="-76">crane_goto_green?</label>
			<nail x="25" y="-59"/>
			<nail x="84" y="-42"/>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="67" y="424">crane_goto_blue?</label>
			<nail x="67" y="407"/>
			<nail x="67" y="450"/>
		</transition>
	</template>
	<template>
		<name>CraneMagnet</name>
		<location id="id86" x="-8" y="76">
			<name x="-93" y="68">MagnetOff</name>
		</location>
		<location id="id87" x="238" y="76">
			<name x="255" y="68">MagnetOn</name>
		</location>
		<location id="id88" x="-8" y="-34">
			<name x="-68" y="-68">StoppedMagnetOn</name>
		</location>
		<location id="id89" x="238" y="-34">
			<name x="178" y="-68">StoppedMagnetOff</name>
		</location>
		<init ref="id86"/>
		<transition>
			<source ref="id87"/>
			<target ref="id89"/>
			<label kind="synchronisation" x="195" y="8">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id86"/>
			<target ref="id88"/>
			<label kind="synchronisation" x="-68" y="8">emergencyStop?</label>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id86"/>
			<label kind="synchronisation" x="42" y="76">crane_toggleMagnet?</label>
		</transition>
		<transition>
			<source ref="id86"/>
			<target ref="id87"/>
			<label kind="synchronisation" x="42" y="76">crane_toggleMagnet?</label>
		</transition>
	</template>
	<template>
		<name>EmergencyButton</name>
		<location id="id90" x="-25" y="-8">
			<name x="-51" y="-42">Running</name>
		</location>
		<location id="id91" x="195" y="-8">
			<name x="170" y="-42">Stopped</name>
		</location>
		<init ref="id90"/>
		<transition>
			<source ref="id90"/>
			<target ref="id91"/>
			<label kind="synchronisation" x="34" y="-25">emergencyStop!</label>
		</transition>
	</template>
	<system>























// Place template instantiations here.
// List one or more processes to be composed into a system.
system MasterController, Disc, Crane, DiscSlot, GetEmptySlot, CraneMagnet, Camera, SlotVariable_finished, GetFinishedSlot, EmergencyButton;</system>
	<queries>
		<query>
			<formula>A&lt;&gt; CraneMagnet.MagnetOn imply CraneMagnet.MagnetOff</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] !deadlock or EmergencyButton.Stopped</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] (Crane.Red and CraneMagnet.MagnetOff) imply !(Crane.Red and CraneMagnet.MagnetOn)</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] (Crane.Red and CraneMagnet.MagnetOn) imply !(Crane.Red and CraneMagnet.MagnetOff)</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] MasterController.gotoIntake_crane imply disc_slots_finished[currentSlot_finished]</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] disc_slots_finished[1] imply disc_occupiedSlots[1]</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; forall (i : id_t) DiscSlot(i).SlotEmpty</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] EmergencyButton.Stopped imply (Crane.Stopped and Disc.Stopped and (CraneMagnet.StoppedMagnetOff or CraneMagnet.StoppedMagnetOn))</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] (EmergencyButton.Stopped and CraneMagnet.MagnetOn) imply CraneMagnet.StoppedMagnetOn</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] !deadlock</formula>
			<comment></comment>
		</query>
		<query>
			<formula>inf{MasterController.SetFinsihedRed} : MasterController.timer</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A&lt;&gt; Disc.Position1</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; Disc.Position2</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; Disc.Position3</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; Disc.Position4</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; Disc.Position2 imply Disc.Position3</formula>
			<comment></comment>
		</query>
		<query>
			<formula>E&lt;&gt; Crane.Intake imply Crane.Red</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A&lt;&gt; Crane.LoweredAtRed imply (Crane.Red or Crane.Stopped)</formula>
			<comment></comment>
		</query>
		<query>
			<formula></formula>
			<comment></comment>
		</query>
	</queries>
</nta>
